{"ast":null,"code":"var _jsxFileName = \"E:\\\\Mern login\\\\client\\\\src\\\\components\\\\pages\\\\admin\\\\product\\\\FileUpload.js\",\n    _s = $RefreshSig$();\n\n// rafce\nimport React from \"react\";\nimport Resize from \"react-image-file-resizer\";\nimport { useSelector } from \"react-redux\";\nimport axios from \"axios\";\nimport { Avatar, Badge } from \"antd\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst FileUpload = _ref => {\n  _s();\n\n  let {\n    values,\n    setValues,\n    loading,\n    setLoading\n  } = _ref;\n  const {\n    user\n  } = useSelector(state => ({ ...state\n  }));\n\n  const handleChangeFile = e => {\n    const files = e.target.files;\n\n    if (files) {\n      setLoading(true);\n      let allfileUpload = values.images; //[] array\n\n      for (let i = 0; i < files.length; i++) {\n        Resize.imageFileResizer( //resize รูป\n        files[i], 720, 720, \"JPEG\", 100, 0, uri => {\n          //uri คือ รูปที่ resize \n          axios.post(process.env.REACT_APP_API + \"/images\", {\n            image: uri\n          }, {\n            headers: {\n              authtoken: user.token\n            }\n          }).then(res => {\n            setLoading(false);\n            allfileUpload.push(res.data); //เก็บรูปที่ upload ไปไว้ใน allfileUpload\n\n            console.log(\"allfileupload in then\", allfileUpload);\n            setValues({ ...values,\n              images: allfileUpload\n            }); //เก็บรูปที่ upload ไปไว้ใน images\n          }).catch(err => {\n            setLoading(false);\n            console.log(err);\n          });\n        }, \"base64\");\n      }\n    }\n  };\n\n  const handleRemove = public_id => {\n    setLoading(true);\n    console.log(public_id); // const img = values.images\n\n    const {\n      images\n    } = values;\n    axios.post(process.env.REACT_APP_API + \"/removeimages\", {\n      public_id\n    }, {\n      headers: {\n        authtoken: user.token\n      }\n    }) // ค่าไม่หายเลยต้องอัพเดทค่าใน state ด้วย\n    .then(res => {\n      setLoading(false);\n      let filterImages = images.filter(item => {\n        //filter รูปที่ไม่ตรงกับ public_id ที่เรากดลบ\n        return item.public_id !== public_id; //return ค่าที่ไม่ตรงกับ public_id ที่เรากดลบ\n      });\n      setValues({ ...values,\n        images: filterImages\n      }); //set ค่าใหม่\n    }).catch(err => {\n      //err\n      setLoading(false);\n      console.log(err);\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this), values.images && values.images.map(c => /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"avatar-item\",\n      children: /*#__PURE__*/_jsxDEV(Badge, {\n        onClick: () => handleRemove(c.public_id),\n        style: {\n          cursor: \"pointer\"\n        },\n        count: \"X\",\n        children: /*#__PURE__*/_jsxDEV(Avatar, {\n          className: \"m-3\",\n          src: c.url,\n          shape: \"square\",\n          size: 120\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 11\n    }, this)), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-group\",\n      children: /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"btn btn-primary\",\n        children: [\"Choose File...\", /*#__PURE__*/_jsxDEV(\"input\", {\n          onChange: handleChangeFile,\n          className: \"form-control\",\n          type: \"file\",\n          hidden: true,\n          multiple: true,\n          accept: \"images/*\",\n          name: \"file\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(FileUpload, \"HA6wZhGeXNR9tzJ3aDGGsGCdOyI=\", false, function () {\n  return [useSelector];\n});\n\n_c = FileUpload;\nexport default FileUpload;\n\nvar _c;\n\n$RefreshReg$(_c, \"FileUpload\");","map":{"version":3,"names":["React","Resize","useSelector","axios","Avatar","Badge","FileUpload","values","setValues","loading","setLoading","user","state","handleChangeFile","e","files","target","allfileUpload","images","i","length","imageFileResizer","uri","post","process","env","REACT_APP_API","image","headers","authtoken","token","then","res","push","data","console","log","catch","err","handleRemove","public_id","filterImages","filter","item","map","c","cursor","url"],"sources":["E:/Mern login/client/src/components/pages/admin/product/FileUpload.js"],"sourcesContent":["// rafce\r\nimport React from \"react\";\r\nimport Resize from \"react-image-file-resizer\";\r\nimport { useSelector } from \"react-redux\";\r\nimport axios from \"axios\";\r\n\r\nimport { Avatar, Badge } from \"antd\";\r\n\r\nconst FileUpload = ({ values, setValues, loading, setLoading }) => {\r\n  const { user } = useSelector((state) => ({ ...state }));\r\n\r\n  const handleChangeFile = (e) => {\r\n    const files = e.target.files;\r\n    if (files) {\r\n      setLoading(true);\r\n\r\n      let allfileUpload = values.images; //[] array\r\n      for (let i = 0; i < files.length; i++) {\r\n        Resize.imageFileResizer(//resize รูป\r\n          files[i],\r\n          720,\r\n          720,\r\n          \"JPEG\",\r\n          100,\r\n          0,\r\n          (uri) => {//uri คือ รูปที่ resize \r\n            axios\r\n              .post(\r\n                process.env.REACT_APP_API + \"/images\",\r\n                {\r\n                  image: uri,\r\n                },\r\n                {\r\n                  headers: {\r\n                    authtoken: user.token,\r\n                  },\r\n                }\r\n              )\r\n              .then((res) => {\r\n                setLoading(false);\r\n                allfileUpload.push(res.data);//เก็บรูปที่ upload ไปไว้ใน allfileUpload\r\n                console.log(\"allfileupload in then\", allfileUpload);\r\n                setValues({ ...values, images: allfileUpload });//เก็บรูปที่ upload ไปไว้ใน images\r\n              })\r\n              .catch((err) => {\r\n                setLoading(false);\r\n                console.log(err);\r\n              });\r\n          },\r\n          \"base64\"\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleRemove = (public_id) => {\r\n    setLoading(true)\r\n    console.log(public_id);\r\n    // const img = values.images\r\n    const { images } = values;\r\n    axios\r\n      .post(\r\n        process.env.REACT_APP_API + \"/removeimages\",\r\n        { public_id },\r\n        {\r\n          headers: {\r\n            authtoken: user.token,\r\n          },\r\n        }\r\n      )\r\n      // ค่าไม่หายเลยต้องอัพเดทค่าใน state ด้วย\r\n      .then((res) => {\r\n        setLoading(false)\r\n        let filterImages = images.filter((item) => {//filter รูปที่ไม่ตรงกับ public_id ที่เรากดลบ\r\n          return item.public_id !== public_id;//return ค่าที่ไม่ตรงกับ public_id ที่เรากดลบ\r\n        });\r\n        setValues({ ...values, images: filterImages });//set ค่าใหม่\r\n      })\r\n      .catch((err) => {\r\n        //err\r\n        setLoading(false)\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <br />\r\n      {values.images &&\r\n        values.images.map((c) => (\r\n          <span className=\"avatar-item\">\r\n            <Badge\r\n              onClick={() => handleRemove(c.public_id)}\r\n              style={{ cursor: \"pointer\" }}\r\n              count=\"X\"\r\n            >\r\n              <Avatar className=\"m-3\" src={c.url} shape=\"square\" size={120} />\r\n            </Badge>\r\n          </span>\r\n        ))}\r\n\r\n      <hr />\r\n      <div className=\"form-group\">\r\n        <label className=\"btn btn-primary\">\r\n          Choose File...\r\n          <input\r\n            onChange={handleChangeFile}\r\n            className=\"form-control\"\r\n            type=\"file\"\r\n            hidden\r\n            multiple\r\n            accept=\"images/*\"\r\n            name=\"file\"\r\n          />\r\n        </label>\r\n      </div>\r\n      <br />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default FileUpload;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}