{"ast":null,"code":"import _objectSpread from\"E:/Mern login/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// rafce\nimport React from\"react\";import Resize from\"react-image-file-resizer\";import{useSelector}from\"react-redux\";import axios from\"axios\";import{Avatar,Badge}from\"antd\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var FileUpload=function FileUpload(_ref){var values=_ref.values,setValues=_ref.setValues,loading=_ref.loading,setLoading=_ref.setLoading;var _useSelector=useSelector(function(state){return _objectSpread({},state);}),user=_useSelector.user;var handleChangeFile=function handleChangeFile(e){var files=e.target.files;if(files){(function(){setLoading(true);var allfileUpload=values.images;//[] array\nfor(var i=0;i<files.length;i++){Resize.imageFileResizer(//resize รูป\nfiles[i],720,720,\"JPEG\",100,0,function(uri){//uri คือ รูปที่ resize \naxios.post(process.env.REACT_APP_API+\"/images\",{image:uri},{headers:{authtoken:user.token}}).then(function(res){setLoading(false);allfileUpload.push(res.data);//เก็บรูปที่ upload ไปไว้ใน allfileUpload\nconsole.log(\"allfileupload in then\",allfileUpload);setValues(_objectSpread(_objectSpread({},values),{},{images:allfileUpload}));//เก็บรูปที่ upload ไปไว้ใน images\n}).catch(function(err){setLoading(false);console.log(err);});},\"base64\");}})();}};var handleRemove=function handleRemove(public_id){setLoading(true);console.log(public_id);// const img = values.images\nvar images=values.images;axios.post(process.env.REACT_APP_API+\"/removeimages\",{public_id:public_id},{headers:{authtoken:user.token}})// ค่าไม่หายเลยต้องอัพเดทค่าใน state ด้วย\n.then(function(res){setLoading(false);var filterImages=images.filter(function(item){//filter รูปที่ไม่ตรงกับ public_id ที่เรากดลบ\nreturn item.public_id!==public_id;//return ค่าที่ไม่ตรงกับ public_id ที่เรากดลบ\n});setValues(_objectSpread(_objectSpread({},values),{},{images:filterImages}));//set ค่าใหม่\n}).catch(function(err){//err\nsetLoading(false);console.log(err);});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"br\",{}),values.images&&values.images.map(function(c){return/*#__PURE__*/_jsx(\"span\",{className:\"avatar-item\",children:/*#__PURE__*/_jsx(Badge,{onClick:function onClick(){return handleRemove(c.public_id);},style:{cursor:\"pointer\"},count:\"X\",children:/*#__PURE__*/_jsx(Avatar,{className:\"m-3\",src:c.url,shape:\"square\",size:120})})});}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"btn btn-primary\",children:[\"Choose File...\",/*#__PURE__*/_jsx(\"input\",{onChange:handleChangeFile,className:\"form-control\",type:\"file\",hidden:true,multiple:true,accept:\"images/*\",name:\"file\"})]})}),/*#__PURE__*/_jsx(\"br\",{})]});};export default FileUpload;","map":{"version":3,"names":["React","Resize","useSelector","axios","Avatar","Badge","FileUpload","values","setValues","loading","setLoading","state","user","handleChangeFile","e","files","target","allfileUpload","images","i","length","imageFileResizer","uri","post","process","env","REACT_APP_API","image","headers","authtoken","token","then","res","push","data","console","log","catch","err","handleRemove","public_id","filterImages","filter","item","map","c","cursor","url"],"sources":["E:/Mern login/client/src/components/pages/admin/product/FileUpload.js"],"sourcesContent":["// rafce\r\nimport React from \"react\";\r\nimport Resize from \"react-image-file-resizer\";\r\nimport { useSelector } from \"react-redux\";\r\nimport axios from \"axios\";\r\n\r\nimport { Avatar, Badge } from \"antd\";\r\n\r\nconst FileUpload = ({ values, setValues, loading, setLoading }) => {\r\n  const { user } = useSelector((state) => ({ ...state }));\r\n\r\n  const handleChangeFile = (e) => {\r\n    const files = e.target.files;\r\n    if (files) {\r\n      setLoading(true);\r\n\r\n      let allfileUpload = values.images; //[] array\r\n      for (let i = 0; i < files.length; i++) {\r\n        Resize.imageFileResizer(//resize รูป\r\n          files[i],\r\n          720,\r\n          720,\r\n          \"JPEG\",\r\n          100,\r\n          0,\r\n          (uri) => {//uri คือ รูปที่ resize \r\n            axios\r\n              .post(\r\n                process.env.REACT_APP_API + \"/images\",\r\n                {\r\n                  image: uri,\r\n                },\r\n                {\r\n                  headers: {\r\n                    authtoken: user.token,\r\n                  },\r\n                }\r\n              )\r\n              .then((res) => {\r\n                setLoading(false);\r\n                allfileUpload.push(res.data);//เก็บรูปที่ upload ไปไว้ใน allfileUpload\r\n                console.log(\"allfileupload in then\", allfileUpload);\r\n                setValues({ ...values, images: allfileUpload });//เก็บรูปที่ upload ไปไว้ใน images\r\n              })\r\n              .catch((err) => {\r\n                setLoading(false);\r\n                console.log(err);\r\n              });\r\n          },\r\n          \"base64\"\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleRemove = (public_id) => {\r\n    setLoading(true)\r\n    console.log(public_id);\r\n    // const img = values.images\r\n    const { images } = values;\r\n    axios\r\n      .post(\r\n        process.env.REACT_APP_API + \"/removeimages\",\r\n        { public_id },\r\n        {\r\n          headers: {\r\n            authtoken: user.token,\r\n          },\r\n        }\r\n      )\r\n      // ค่าไม่หายเลยต้องอัพเดทค่าใน state ด้วย\r\n      .then((res) => {\r\n        setLoading(false)\r\n        let filterImages = images.filter((item) => {//filter รูปที่ไม่ตรงกับ public_id ที่เรากดลบ\r\n          return item.public_id !== public_id;//return ค่าที่ไม่ตรงกับ public_id ที่เรากดลบ\r\n        });\r\n        setValues({ ...values, images: filterImages });//set ค่าใหม่\r\n      })\r\n      .catch((err) => {\r\n        //err\r\n        setLoading(false)\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <br />\r\n      {values.images &&\r\n        values.images.map((c) => (\r\n          <span className=\"avatar-item\">\r\n            <Badge\r\n              onClick={() => handleRemove(c.public_id)}\r\n              style={{ cursor: \"pointer\" }}\r\n              count=\"X\"\r\n            >\r\n              <Avatar className=\"m-3\" src={c.url} shape=\"square\" size={120} />\r\n            </Badge>\r\n          </span>\r\n        ))}\r\n\r\n      <hr />\r\n      <div className=\"form-group\">\r\n        <label className=\"btn btn-primary\">\r\n          Choose File...\r\n          <input\r\n            onChange={handleChangeFile}\r\n            className=\"form-control\"\r\n            type=\"file\"\r\n            hidden\r\n            multiple\r\n            accept=\"images/*\"\r\n            name=\"file\"\r\n          />\r\n        </label>\r\n      </div>\r\n      <br />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default FileUpload;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}