{"ast":null,"code":"import { Base } from './Base.js';\nimport * as utils from './utils.js';\nexport class Struct extends Base {\n  constructor() {\n    let fields = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n    this.fields = fields;\n  }\n\n  decode(stream, parent) {\n    let length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    const res = this._setup(stream, parent, length);\n\n    this._parseFields(stream, res, this.fields);\n\n    if (this.process != null) {\n      this.process.call(res, stream);\n    }\n\n    return res;\n  }\n\n  _setup(stream, parent, length) {\n    const res = {}; // define hidden properties\n\n    Object.defineProperties(res, {\n      parent: {\n        value: parent\n      },\n      _startOffset: {\n        value: stream.pos\n      },\n      _currentOffset: {\n        value: 0,\n        writable: true\n      },\n      _length: {\n        value: length\n      }\n    });\n    return res;\n  }\n\n  _parseFields(stream, res, fields) {\n    for (let key in fields) {\n      var val;\n      const type = fields[key];\n\n      if (typeof type === 'function') {\n        val = type.call(res, res);\n      } else {\n        val = type.decode(stream, res);\n      }\n\n      if (val !== undefined) {\n        if (val instanceof utils.PropertyDescriptor) {\n          Object.defineProperty(res, key, val);\n        } else {\n          res[key] = val;\n        }\n      }\n\n      res._currentOffset = stream.pos - res._startOffset;\n    }\n  }\n\n  size(val, parent) {\n    let includePointers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n\n    if (val == null) {\n      val = {};\n    }\n\n    const ctx = {\n      parent,\n      val,\n      pointerSize: 0\n    };\n\n    if (this.preEncode != null) {\n      this.preEncode.call(val);\n    }\n\n    let size = 0;\n\n    for (let key in this.fields) {\n      const type = this.fields[key];\n\n      if (type.size != null) {\n        size += type.size(val[key], ctx);\n      }\n    }\n\n    if (includePointers) {\n      size += ctx.pointerSize;\n    }\n\n    return size;\n  }\n\n  encode(stream, val, parent) {\n    let type;\n\n    if (this.preEncode != null) {\n      this.preEncode.call(val, stream);\n    }\n\n    const ctx = {\n      pointers: [],\n      startOffset: stream.pos,\n      parent,\n      val,\n      pointerSize: 0\n    };\n    ctx.pointerOffset = stream.pos + this.size(val, ctx, false);\n\n    for (let key in this.fields) {\n      type = this.fields[key];\n\n      if (type.encode != null) {\n        type.encode(stream, val[key], ctx);\n      }\n    }\n\n    let i = 0;\n\n    while (i < ctx.pointers.length) {\n      const ptr = ctx.pointers[i++];\n      ptr.type.encode(stream, ptr.val, ptr.parent);\n    }\n  }\n\n}","map":{"version":3,"names":["Base","utils","Struct","constructor","fields","decode","stream","parent","length","res","_setup","_parseFields","process","call","Object","defineProperties","value","_startOffset","pos","_currentOffset","writable","_length","key","val","type","undefined","PropertyDescriptor","defineProperty","size","includePointers","ctx","pointerSize","preEncode","encode","pointers","startOffset","pointerOffset","i","ptr"],"sources":["E:/Mern login/client/node_modules/restructure/src/Struct.js"],"sourcesContent":["import {Base} from './Base.js';\nimport * as utils from './utils.js';\n\nexport class Struct extends Base {\n  constructor(fields = {}) {\n    super();\n    this.fields = fields;\n  }\n\n  decode(stream, parent, length = 0) {\n    const res = this._setup(stream, parent, length);\n    this._parseFields(stream, res, this.fields);\n\n    if (this.process != null) {\n      this.process.call(res, stream);\n    }\n    return res;\n  }\n\n  _setup(stream, parent, length) {\n    const res = {};\n\n    // define hidden properties\n    Object.defineProperties(res, {\n      parent:         { value: parent },\n      _startOffset:   { value: stream.pos },\n      _currentOffset: { value: 0, writable: true },\n      _length:        { value: length }\n    });\n\n    return res;\n  }\n\n  _parseFields(stream, res, fields) {\n    for (let key in fields) {\n      var val;\n      const type = fields[key];\n      if (typeof type === 'function') {\n        val = type.call(res, res);\n      } else {\n        val = type.decode(stream, res);\n      }\n\n      if (val !== undefined) {\n        if (val instanceof utils.PropertyDescriptor) {\n          Object.defineProperty(res, key, val);\n        } else {\n          res[key] = val;\n        }\n      }\n\n      res._currentOffset = stream.pos - res._startOffset;\n    }\n\n  }\n\n  size(val, parent, includePointers = true) {\n    if (val == null) { val = {}; }\n    const ctx = {\n      parent,\n      val,\n      pointerSize: 0\n    };\n\n    if (this.preEncode != null) {\n      this.preEncode.call(val);\n    }\n\n    let size = 0;\n    for (let key in this.fields) {\n      const type = this.fields[key];\n      if (type.size != null) {\n        size += type.size(val[key], ctx);\n      }\n    }\n\n    if (includePointers) {\n      size += ctx.pointerSize;\n    }\n\n    return size;\n  }\n\n  encode(stream, val, parent) {\n    let type;\n    if (this.preEncode != null) {\n      this.preEncode.call(val, stream);\n    }\n\n    const ctx = {\n      pointers: [],\n      startOffset: stream.pos,\n      parent,\n      val,\n      pointerSize: 0\n    };\n\n    ctx.pointerOffset = stream.pos + this.size(val, ctx, false);\n\n    for (let key in this.fields) {\n      type = this.fields[key];\n      if (type.encode != null) {\n        type.encode(stream, val[key], ctx);\n      }\n    }\n\n    let i = 0;\n    while (i < ctx.pointers.length) {\n      const ptr = ctx.pointers[i++];\n      ptr.type.encode(stream, ptr.val, ptr.parent);\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}