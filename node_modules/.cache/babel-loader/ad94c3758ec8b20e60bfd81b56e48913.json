{"ast":null,"code":"import _defineProperty from\"E:/Mern login/client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"E:/Mern login/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"E:/Mern login/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";//rafce\nimport React,{useState}from\"react\";// functions\nimport{login}from\"../../functions/auth\";// redux\nimport{useDispatch}from\"react-redux\";// use dispatch ในการส่งข้อมูลไปบันทึก\n// V.6\nimport{useNavigate,useLocation}from\"react-router-dom\";import{Spin}from\"antd\";import{toast}from\"react-toastify\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Login=function Login(){var navigate=useNavigate();var dispatch=useDispatch();var location=useLocation();// let history = useHistory();\nvar _useState=useState({//เก็บค่าที่กรอกใน form\nusername:\"\",password:\"\"}),_useState2=_slicedToArray(_useState,2),value=_useState2[0],setValue=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var roleBaseRedirect=function roleBaseRedirect(role){//เปลี่ยนหน้าตาม role\nvar intended=location.state;if(intended){navigate('../'+intended);}else{if(role===\"admin\"){navigate(\"/admin/index\");}else{navigate(\"/user/index\");}}};var handleChange=function handleChange(e){//การเปลี่ยนแปลงค่าใน input\nsetValue(_objectSpread(_objectSpread({},value),{},_defineProperty({},e.target.name,e.target.value)));};var handleSubmit=function handleSubmit(e){setLoading(true);e.preventDefault();//ไม่ให้รีโหลด ปัญหา\nconsole.log(value);//code\nlogin(value)//ส่งข้อมูลไปที่ server\n.then(function(res){setLoading(false);// console.log('res',res.data);\ntoast.success(res.data.payload.user.username+\" Login Success\");dispatch({type:\"LOGIN\",//store ข้อมูลไว้ใน redux\npayload:{//เก็บค่า token, username, role ไว้ใน redux\ntoken:res.data.token,username:res.data.payload.user.username,role:res.data.payload.user.role}});localStorage.setItem(\"token\",res.data.token);//เก็บค่า token ไว้ใน localstorage เพื่อไม่หายเมื่อรีเฟรชหน้า \nroleBaseRedirect(res.data.payload.user.role);}).catch(function(err){setLoading(false);console.log(err.response.data);toast.error(err.response.data);});};return/*#__PURE__*/_jsx(\"div\",{className:\"container p-5\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 offset-md-3\",children:[loading?/*#__PURE__*/_jsxs(\"h1\",{children:[\"Loading ...\",/*#__PURE__*/_jsx(Spin,{})]}):/*#__PURE__*/_jsx(\"h1\",{children:\"Login Page\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{className:\"form-control\",type:\"text\",name:\"username\",onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{className:\"form-control\",type:\"password\",name:\"password\",onChange:handleChange})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-success\",children:\"Submit\"})]})]})})});};export default Login;","map":{"version":3,"names":["React","useState","login","useDispatch","useNavigate","useLocation","Spin","toast","Login","navigate","dispatch","location","username","password","value","setValue","loading","setLoading","roleBaseRedirect","role","intended","state","handleChange","e","target","name","handleSubmit","preventDefault","console","log","then","res","success","data","payload","user","type","token","localStorage","setItem","catch","err","response","error"],"sources":["E:/Mern login/client/src/components/pages/auth/Login.js"],"sourcesContent":["//rafce\r\nimport React, { useState } from \"react\";\r\n\r\n// functions\r\nimport { login } from \"../../functions/auth\";\r\n\r\n// redux\r\nimport { useDispatch } from \"react-redux\";// use dispatch ในการส่งข้อมูลไปบันทึก\r\n// V.6\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\n\r\nimport { Spin } from \"antd\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nconst Login = () => {\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n  const location = useLocation();\r\n\r\n  // let history = useHistory();\r\n  const [value, setValue] = useState({//เก็บค่าที่กรอกใน form\r\n    username: \"\",\r\n    password: \"\",\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const roleBaseRedirect = (role) => {//เปลี่ยนหน้าตาม role\r\n    let intended = location.state;\r\n    if (intended) {\r\n      navigate('../'+intended);\r\n    } else {\r\n      if (role === \"admin\") {\r\n        navigate(\"/admin/index\");\r\n      } else {\r\n        navigate(\"/user/index\");\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleChange = (e) => {//การเปลี่ยนแปลงค่าใน input\r\n    setValue({\r\n      ...value,\r\n      [e.target.name]: e.target.value,\r\n    });\r\n  };\r\n\r\n  const handleSubmit = (e) => {\r\n    setLoading(true);\r\n    e.preventDefault();//ไม่ให้รีโหลด ปัญหา\r\n    console.log(value);\r\n    //code\r\n    login(value)//ส่งข้อมูลไปที่ server\r\n      .then((res) => {\r\n        setLoading(false);\r\n        // console.log('res',res.data);\r\n        toast.success(res.data.payload.user.username + \" Login Success\");\r\n        dispatch({\r\n          type: \"LOGIN\",//store ข้อมูลไว้ใน redux\r\n          payload: {//เก็บค่า token, username, role ไว้ใน redux\r\n            token: res.data.token,\r\n            username: res.data.payload.user.username,\r\n            role: res.data.payload.user.role,\r\n          },\r\n        });\r\n\r\n        localStorage.setItem(\"token\", res.data.token);//เก็บค่า token ไว้ใน localstorage เพื่อไม่หายเมื่อรีเฟรชหน้า \r\n        roleBaseRedirect(res.data.payload.user.role);\r\n      })\r\n      .catch((err) => {\r\n        setLoading(false);\r\n        console.log(err.response.data);\r\n        toast.error(err.response.data);\r\n      });\r\n  };\r\n\r\n  return (\r\n    <div className=\"container p-5\">\r\n      <div className=\"row\">\r\n        <div className=\"col-md-6 offset-md-3\">\r\n          {loading ? (\r\n            <h1>\r\n              Loading ...\r\n              <Spin />\r\n            </h1>\r\n          ) : (\r\n            <h1>Login Page</h1>\r\n          )}\r\n\r\n          <form onSubmit={handleSubmit}>\r\n            <div className=\"form-group\">\r\n              <label>Username</label>\r\n              <input\r\n                className=\"form-control\"\r\n                type=\"text\"\r\n                name=\"username\"\r\n                onChange={handleChange}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"form-group\">\r\n              <label>Password</label>\r\n              <input\r\n                className=\"form-control\"\r\n                type=\"password\"\r\n                name=\"password\"\r\n                onChange={handleChange}\r\n              />\r\n            </div>\r\n            <br />\r\n            <button className=\"btn btn-success\">Submit</button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}